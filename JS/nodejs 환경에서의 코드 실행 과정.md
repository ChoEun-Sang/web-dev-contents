## node.js 환경에서의 코드 실행 과정

JavaScript 코드의 실행 과정은 브라우저나 Node.js 환경에서 V8 엔진을 통해 이루어지며, V8 엔진은 JavaScript 코드를 기계어로 변환하여 실행하는 역할을 합니다. 이 과정을 이해하기 위해서는 JavaScript 코드가 어떻게 해석되고, 최적화되고, 실행되는지 단계별로 살펴볼 필요가 있습니다.

1. 파싱 (Parsing)
   소스 코드 입력: JavaScript 소스 코드가 브라우저나 Node.js 환경에 입력됩니다.
   토큰화 (Tokenization): V8 엔진은 소스 코드를 읽고 이를 토큰(Token)이라는 작은 단위로 분해합니다. 예를 들어, let x = 5;라는 코드는 let, x, =, 5, ;라는 토큰들로 분리됩니다.
   구문 분석 (Parsing): 토큰화된 코드는 구문 분석 과정을 거치며, 이를 통해 추상 구문 트리(AST, Abstract Syntax Tree)라는 구조체로 변환됩니다. 이 AST는 코드의 구조와 의미를 이해하기 쉽게 표현한 트리 형태의 데이터 구조입니다.
2. 바이트코드 생성 (Bytecode Generation)
   이그니션 (Ignition) 사용: AST가 생성되면, V8의 이그니션(Ignition) 인터프리터가 이를 바이트코드(Bytecode)로 변환합니다. 바이트코드는 기계어로 컴파일되기 전에 중간 단계로 실행 가능한 코드입니다.
   초기 실행: 바이트코드로 변환된 JavaScript 코드는 이그니션에 의해 바로 실행됩니다. 이 초기 실행 단계에서는 빠르게 코드를 실행하는 것이 목표이므로, 코드가 최적화되지는 않은 상태입니다.
3. 실행 및 프로파일링 (Execution & Profiling)
   바이트코드 실행: 이그니션 인터프리터는 바이트코드를 순차적으로 실행합니다.
   프로파일링: 코드가 실행되면서, V8 엔진은 어떤 코드가 자주 실행되는지(핫스팟)를 모니터링합니다. 이러한 프로파일링 정보를 바탕으로 성능에 중요한 코드 경로를 식별합니다.
4. 최적화 컴파일 (Optimization Compilation)
   터보팬 (TurboFan) 사용: V8 엔진은 프로파일링 정보를 바탕으로 자주 실행되는 코드(핫스팟 코드)를 최적화하기 위해 터보팬(TurboFan)이라는 JIT(Just-In-Time) 컴파일러를 사용합니다.
   기계어로 컴파일: 터보팬은 핫스팟 코드를 네이티브 기계어로 컴파일합니다. 이 과정에서 성능을 최적화하기 위해 다양한 최적화 기법들이 적용됩니다.
   최적화된 코드 실행: 최적화된 기계어 코드는 이후에 동일한 코드가 실행될 때 사용되며, 더 빠른 실행 속도를 제공합니다.
5. 디옵티마이제이션 (Deoptimization)
   최적화 해제: 때로는 V8 엔진이 최적화된 코드가 더 이상 유효하지 않다고 판단할 수 있습니다. 예를 들어, 코드가 예기치 않은 입력을 받아 최적화된 가정이 깨질 때가 있습니다. 이 경우, 터보팬은 최적화를 해제하고 다시 바이트코드나 다른 형태의 코드를 실행할 수 있습니다.
6. 가비지 컬렉션 (Garbage Collection)
   메모리 관리: JavaScript는 자동 메모리 관리를 지원하며, V8 엔진은 더 이상 사용되지 않는 객체를 자동으로 메모리에서 해제합니다. 이 작업은 가비지 컬렉터(Garbage Collector)에 의해 주기적으로 수행되며, 메모리 누수를 방지합니다.

### 요약

JavaScript 코드가 실행되는 과정은 다음과 같은 단계로 요약할 수 있습니다:

- 파싱: 코드를 토큰화하고 AST를 생성합니다.
- 바이트코드 생성: 이그니션 인터프리터가 AST를 바이트코드로 변환하고 실행합니다.
- 프로파일링 및 최적화: 자주 실행되는 코드를 터보팬이 기계어로 최적화하여 컴파일합니다.
- 최적화된 코드 실행: 최적화된 기계어 코드를 실행하여 성능을 향상시킵니다.
- 디옵티마이제이션: 필요시 최적화된 코드를 해제하고 원래 방식으로 실행합니다.
- 가비지 컬렉션: 사용하지 않는 메모리를 자동으로 정리합니다.

## useMemo, useCallback

`useMemo`나 `useCallback`으로 메모이제이션한 함수는 React의 내부 메모리 구조에 **참조값**으로 저장됩니다. 이 값은 컴포넌트가 재렌더링되더라도 동일한 참조를 유지하여 성능을 최적화하는 방식으로 작동합니다.

### 1. **어디에 저장되는가?**

- **React의 컴포넌트 상태**: React는 컴포넌트마다 훅의 상태를 관리하는 내부 구조를 갖고 있습니다. 컴포넌트가 렌더링될 때, `useMemo`나 `useCallback`으로 반환된 값은 **React의 훅 상태 시스템**에 저장됩니다.
- 이 값은 **컴포넌트 렌더링 사이클** 동안 유지되며, 렌더링이 발생할 때마다 React는 이 저장된 값을 다시 참조합니다.

### 2. **어떤 형태로 저장되는가?**

- 메모이제이션된 값이나 함수는 **참조(reference)**로 저장됩니다. 즉, 메모리에 함수나 값의 실제 데이터가 저장되는 것이 아니라, 해당 값이나 함수에 대한 **참조**가 저장됩니다.

#### `useCallback`의 경우

```javascript
const handleSearch = useCallback(
  debounce(() => setValue, 500),
  []
);
```

- `useCallback`은 `debounce(() => setValue, 500)` 함수를 래핑하여 메모이제이션합니다.
- 이때 React는 해당 함수의 **참조**를 내부에 저장하고, 의존성 배열(`[]`)이 변경되지 않으면 저장된 참조를 재사용합니다.
- 참조값은 메모리 상에서 함수가 정의된 위치를 가리키고 있으며, 새로운 참조가 생성되지 않으므로 함수는 재생성되지 않습니다.

#### `useMemo`의 경우

```javascript
const debouncedFunction = useMemo(() => debounce(() => setValue, 500), []);
```

- `useMemo`는 `debounce`로 감싼 **값**을 반환합니다. 이 값은 역시 메모이제이션된 **참조값**으로 저장됩니다.
- 의존성 배열이 변경되지 않는 한 `debouncedFunction`의 참조가 유지됩니다. 값 자체는 실행 결과에 해당하지만, 이 값을 참조하는 변수가 메모리 내에서 참조값으로 관리됩니다.

### 3. **어떻게 저장되는가?**

- React는 컴포넌트 렌더링 시 훅(`useMemo`, `useCallback`)에 의해 생성된 값이나 함수에 대한 **참조값을 기억**하고, 렌더링이 발생할 때마다 그 값을 재사용합니다. 구체적으로는, 메모리 상에 해당 함수의 참조를 저장하고, 렌더링이 일어날 때마다 같은 참조를 리턴합니다.

### 4. **저장 방식의 예시**

1. **초기 렌더링 시**:

   - `useCallback` 또는 `useMemo`가 처음 호출될 때, `debounce`로 래핑된 함수나 값이 계산됩니다.
   - React는 이 값 또는 함수에 대한 **참조를 내부 메모리에 저장**합니다.

2. **후속 렌더링 시**:
   - React는 의존성 배열을 확인한 후, 변경되지 않았다면 기존의 **참조된 값**이나 **함수 참조**를 반환합니다.
   - 이 과정에서 함수나 값의 재생성을 피하고, 기존 참조값을 유지하여 성능 최적화를 이룹니다.

### 5. **메모리 구조 예시**

```javascript
function MyComponent() {
  const debouncedValue = useMemo(() => debounce(() => setValue, 500), []);

  // React의 내부에서는
  // {
  //   key: 'debouncedValue',
  //   value: <debounced 함수에 대한 참조값>
  // }
}
```

React는 `debouncedValue`라는 훅 상태를 내부적으로 관리하고 있으며, 여기에 함수에 대한 **참조값**을 저장합니다. 이 값은 의존성 배열이 변경될 때까지 동일한 참조를 유지합니다.

### 요약

- **어디에 저장되나요?**: React의 내부 메모리에서 훅 상태로 관리됩니다.
- **어떤 형태로 저장되나요?**: 메모이제이션된 값이나 함수의 **참조값**이 저장됩니다.
- **어떻게 저장되나요?**: React는 `useCallback` 또는 `useMemo`로 생성된 값이나 함수의 참조를 기억하고, 컴포넌트 렌더링 시 동일한 참조를 반환하여 성능을 최적화합니다.

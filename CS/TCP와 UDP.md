## TCP와 UDP

### TCP 란?

> IP 규칙으로만 통신하기에 불안정한 점(패킷 순서, 패킷 유실)을 커버해, 패킷 전송을 제어하며 데이터의 신뢰성을 보증하는 프로토콜입니다.

IP와 TCP 둘다 프로토콜이지만, 각각 별개의 규칙입니다.
IP 주소로 데이터를 목적지까지 보낸다면, TCP는 데이터가 정확하게 도착했는지 확인합니다.

1. 전송데이터에 TCP 정보를 생성합니다. (출발지 PORT, 목적지 PORT, 전송 제어, 순서, 검증 정보 등)

2. TCP 정보를 포함한 전송데이터를 IP 패킷을 생성합니다. (출발지 IP, 목적지 IP)

3. IP 패킷까지 생성한 데이터를 이더넷 프레임으로 포함합니다.

4. 인터넷을 통해 목적지 서버에 도달하면 각 정보를 확인하여 전송 데이터를 받습니다.

<img width="500" alt="전송데이터 전달 과정 이미지" src="https://github.com/user-attachments/assets/725cc2dd-499c-4c70-a099-e131ca439bb8">

### TCP 통신 과정

`3 way handshake` -> `데이터 송수신` -> `4 way handshake`

**연결 설정 - 3 way handshake**

1. SYN (Synchronize)
   먼저, 클라이언트는 서버와의 연결을 시작하기 위해 SYN 플래그가 설정된 패킷을 서버로 보낸다. 이 패킷에는 초기 시퀀스 번호(ISN, Initial Sequence Number)가 포함되어 있다. ISN은 임의의 숫자로, 데이터 전송 순서를 관리하기 위해 사용됩니다.

`클라이언트 → 서버: SYN, ISN(client)`

2. SYN-ACK (Synchronize-Acknowledge)
   서버는 클라이언트의 SYN 패킷을 수신한 후, 이를 확인하고 응답한다. 서버는 SYN 플래그와 ACK(Acknowledgment) 플래그가 모두 설정된 패킷을 클라이언트로 보낸다. 이 패킷에는 서버의 ISN과 클라이언트의 ISN에 대한 확인 응답이 포함되어 있다.

`서버 → 클라이언트: SYN, ISN(server), ACK(ISN(client) + 1)`

여기서 ACK(ISN(client) + 1)은 클라이언트의 초기 시퀀스 번호에 1을 더한 값입니다. 이는 클라이언트의 SYN 패킷에 대한 응답임을 나타냅니다.

3. ACK (Acknowledge)
   클라이언트는 서버의 SYN-ACK 패킷을 수신한 후, 서버의 ISN에 대한 확인 응답을 보낸다. 이 패킷은 ACK 플래그가 설정되어 있으며, 서버의 ISN에 1을 더한 값을 포함한다. 이 단계가 완료되면 TCP 연결이 성립된다.

`클라이언트 → 서버: ACK(ISN(server) + 1)`

**요약** <br/>
Step 1: SYN (클라이언트 → 서버): 클라이언트가 연결 요청을 보내며, ISN을 포함한 SYN 패킷을 전송한다.
Step 2: SYN-ACK (서버 → 클라이언트): 서버가 클라이언트의 요청을 확인하고, 자신의 ISN을 포함한 SYN-ACK 패킷을 전송한다.
Step 3: ACK (클라이언트 → 서버): 클라이언트가 서버의 ISN을 확인하고, ACK 패킷을 전송하여 연결을 완료한다.

**연결 종료 - 4 way handshake**

1. FIN 보내기 (FIN sent):

클라이언트(혹은 서버)가 연결을 종료하고자 할 때, FIN 플래그가 설정된 세그먼트를 전송합니다. 이 단계에서 클라이언트는 데이터를 더 이상 전송하지 않겠다는 의사를 서버에게 알립니다.

`세그먼트: FIN`

2)ACK 확인 (ACK received):

서버는 클라이언트로부터 FIN 세그먼트를 수신하면, 이를 확인하고 ACK 플래그가 설정된 세그먼트를 클라이언트에게 전송합니다. 이는 서버가 FIN 세그먼트를 받았다는 확인을 의미합니다.

`세그먼트: ACK`

3. FIN 보내기 (FIN sent):

서버는 연결을 종료할 준비가 되면 FIN 플래그가 설정된 세그먼트를 클라이언트에게 다시 전송합니다. 이는 서버가 데이터를 더 이상 전송하지 않겠다는 의사를 클라이언트에게 알리는 것입니다.

`세그먼트: FIN`

4. ACK 확인 (ACK received):

클라이언트는 서버로부터 FIN 세그먼트를 수신하면, 이를 확인하고 ACK 플래그가 설정된 세그먼트를 서버에게 전송합니다. 이 단계에서 클라이언트는 서버가 보낸 FIN 세그먼트를 받았다는 것을 확인합니다.

`세그먼트: ACK`

### UDP 란?

TCP와 달리 연결 지향적이지 않은 프로토콜로, 데이터를 신속하게 전송하기 위해 설계되었다. TCP와 달리 연결 설정이나 종료 과정이 없으며, 데이터의 신뢰성, 순서 보장 등을 제공하지 않는다.

> UDP(User Datagram Protocol)는 단어에서도 알 수 있듯이 데이터그램 방식을 사용하는 프로토콜이기 때문에 애초에 각각의 패킷 간의 순서가 존재하지 않는 독립적인 패킷을 사용한다.

즉, UDP는 신뢰성을 확보하기 위해 거치던 TCP의 과정(hanshake)을 거치지 않기 때문에 속도가 더 빠를 수 밖에 없다는 것이다. 그래서 UDP는 실시간 영상 스트리밍과 같은 고용량 데이터를 다루는 곳에 이용된다.

UDP 헤더 구성도 PORT 번호 외 Checksum만 포함돼 있다.

UDP는 신뢰성이 없는게 아니라 탑재를 안했을 뿐이다. UDP의 진짜 장점은 커스터마이징이 가능하다는 점이다.
즉, UDP 자체는 헤더에 들은게 없어 신뢰성이 낮고 제어 기능도 없지만, 이후 개발자가 애플리케이션에서 구현을 어떻게 하냐에 따라서 TCP와 비슷한 수준의 기능을 가질 수도 있다는 말이다.

## 출처

[아직도 모호한 TCP / UDP 개념 ❓ 쉽게 이해하자](https://inpa.tistory.com/entry/NW-%F0%9F%8C%90-%EC%95%84%EC%A7%81%EB%8F%84-%EB%AA%A8%ED%98%B8%ED%95%9C-TCP-UDP-%EA%B0%9C%EB%85%90-%E2%9D%93-%EC%89%BD%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%98%EC%9E%90)
